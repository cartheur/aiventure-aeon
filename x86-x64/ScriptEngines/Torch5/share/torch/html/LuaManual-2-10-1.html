<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>

  Garbage-Collection Metamethods
</title>
<link href="doctorch.css" rel="stylesheet" type="text/css">
</head>

<body class="torchdoc">
<div id="container">

<div id="header">
<h3>
  Garbage-Collection Metamethods</h3>
</div>

<div id="navline">
<a href="index.html">Torch Manual</a>&nbsp; > &nbsp; <a href="LuaManual.html">
Lua 5.1 Reference Manual</a>&nbsp; > &nbsp; <a href="LuaManual-2.html">
  The Language</a>&nbsp; > &nbsp; <a href="LuaManual-2-10.html">
  Garbage Collection</a>&nbsp; > &nbsp; <b>
  Garbage-Collection Metamethods</b>
</div>

<div id="contents">
<a name="GarbageCollectionMetamethods"></a>

<p>

<p>

<p>

 Using the C API, you can set garbage-collector metamethods for userdata (see <a href="LuaManual-2-8.html#Metatables">Metatables</a>). These metamethods are also called <i>finalizers</i>. Finalizers allow you to coordinate Lua's garbage collection with external resource management (such as closing files, network or database connections, or freeing your own memory).   
<p>

 Garbage userdata with a field <code>__gc</code> in their metatables are not collected immediately by the garbage collector. Instead, Lua puts them in a list. After the collection, Lua does the equivalent of the following function for each userdata in that list:
<pre>
     function gc_event (udata)
       local h = metatable(udata).__gc
       if h then
         h(udata)
       end
     end
</pre>
<p>

<p>

 At the end of each garbage-collection cycle, the finalizers for userdata are called in <i>reverse</i> order of their creation, among those collected in that cycle. That is, the first finalizer to be called is the one associated with the userdata created last in the program.      
</div>



<div id="footer-left">&nbsp;<a href=""></a></div>
<div id="footer-right"><a href="LuaManual-2-10-2.html">
  Weak Tables</a>&nbsp;</div>

<div id="last-modified">

</div>

</div>
</body>
</html>
