<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>

  Function Definitions
</title>
<link href="doctorch.css" rel="stylesheet" type="text/css">
</head>

<body class="torchdoc">
<div id="container">

<div id="header">
<h3>
  Function Definitions</h3>
</div>

<div id="navline">
<a href="index.html">Torch Manual</a>&nbsp; > &nbsp; <a href="LuaManual.html">
Lua 5.1 Reference Manual</a>&nbsp; > &nbsp; <a href="LuaManual-2.html">
  The Language</a>&nbsp; > &nbsp; <a href="LuaManual-2-5.html">
  Expressions</a>&nbsp; > &nbsp; <b>
  Function Definitions</b>
</div>

<div id="contents">
<a name="FunctionDefinitions"></a>

<p>

<p>

<p>

 The syntax for function definition is
<pre>
	function ::= *function* funcbody
	funcbody ::= `*(*` [parlist1] `*)*` block *end*
</pre>
<p>

<p>

 The following syntactic sugar simplifies function definitions:
<pre>
	stat ::= *function* funcname funcbody
	stat ::= *local* *function* Name funcbody
	funcname ::= Name {`*.*` Name} [`*:*` Name]
</pre>
<p>

<p>

 The statement
<pre>
     function f () _body_ end
</pre>
<p>

<p>

 translates to
<pre>
     f = function () _body_ end
</pre>
<p>

<p>

 The statement
<pre>
     function t.a.b.c.f () _body_ end
</pre>
<p>

<p>

 translates to
<pre>
     t.a.b.c.f = function () _body_ end
</pre>
<p>

<p>

 The statement
<pre>
     local function f () _body_ end
</pre>
<p>

<p>

 translates to
<pre>
     local f; f = function () _body_ end
</pre>
<p>

<p>

 <i>not</i> to
<pre>
     local f = function () _body_ end
</pre>
<p>

<p>

 (This only makes a difference when the body of the function contains references to <code>f</code>.)   
<p>

 A function definition is an executable expression, whose value has type <i>function</i>. When Lua pre-compiles a chunk, all its function bodies are pre-compiled too. Then, whenever Lua executes the function definition, the function is <i>instantiated</i> (or <i>closed</i>). This function instance (or <i>closure</i>) is the final value of the expression. Different instances of the same function may refer to different  external local variables and may have different environment tables.   
<p>

 Parameters act as local variables that are initialized with the argument values:
<pre>
	parlist1 ::= namelist [`*,*` `*...*`] | `*...*`
</pre>
<p>

<p>

 When a function is called, the list of arguments is adjusted to the length of the list of parameters, unless the function is a variadic or <i>vararg function</i>, which is indicated by three dots ('=...=') at the end of its parameter list. A vararg function does not adjust its argument list; instead, it collects all extra arguments and supplies them to the function through a <i>vararg expression</i>, which is also written as three dots. The value of this expression is a list of all actual extra arguments, similar to a function with multiple results. If a vararg expression is used inside another expression or in the middle of a list of expressions, then its return list is adjusted to one element. If the expression is used as the last element of a list of expressions, then no adjustment is made (unless the call is enclosed in parentheses).   
<p>

 As an example, consider the following definitions:
<pre>
     function f(a, b) end
     function g(a, b, ...) end
     function r() return 1,2,3 end
</pre>
<p>

<p>

 Then, we have the following mapping from arguments to parameters and to the vararg expression:
<pre>
     CALL            PARAMETERS
     
     f(3)             a=3, b=nil
     f(3, 4)          a=3, b=4
     f(3, 4, 5)       a=3, b=4
     f(r(), 10)       a=1, b=10
     f(r())           a=1, b=2
     
     g(3)             a=3, b=nil, ... -->  (nothing)
     g(3, 4)          a=3, b=4,   ... -->  (nothing)
     g(3, 4, 5, 8)    a=3, b=4,   ... -->  5  8
     g(5, r())        a=5, b=1,   ... -->  2  3
</pre>
<p>

<p>

 Results are returned using the <b>return</b> statement (see <a href="LuaManual-2-4-4.html#ControlStructures">Control Structures</a>). If control reaches the end of a function without encountering a <b>return</b> statement, then the function returns with no results.   
<p>

 The <i>colon</i> syntax is used for defining <i>methods</i>, that is, functions that have an implicit extra parameter <code>self</code>. Thus, the statement
<pre>
     function t.a.b.c:f (_params_) _body_ end
</pre>
<p>

<p>

 is syntactic sugar for
<pre>
     t.a.b.c.f = function (self, _params_) _body_ end
</pre>
<p>

</div>



<div id="footer-left">&nbsp;<a href="LuaManual-2-5-8.html">
  Function Calls</a></div>
<div id="footer-right"><a href=""></a>&nbsp;</div>

<div id="last-modified">

</div>

</div>
</body>
</html>
