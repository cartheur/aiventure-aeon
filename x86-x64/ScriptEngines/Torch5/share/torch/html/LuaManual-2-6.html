<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>

  Visibility Rules
</title>
<link href="doctorch.css" rel="stylesheet" type="text/css">
</head>

<body class="torchdoc">
<div id="container">

<div id="header">
<h3>
  Visibility Rules</h3>
</div>

<div id="navline">
<a href="index.html">Torch Manual</a>&nbsp; > &nbsp; <a href="LuaManual.html">
Lua 5.1 Reference Manual</a>&nbsp; > &nbsp; <a href="LuaManual-2.html">
  The Language</a>&nbsp; > &nbsp; <b>
  Visibility Rules</b>
</div>

<div id="contents">
<a name="VisibilityRules"></a>

<p>

<p>

<p>

  Lua is a lexically scoped language. The scope of variables begins at the first statement <i>after</i> their declaration and lasts until the end of the innermost block that includes the declaration. Consider the following example:
<pre>
     x = 10                -- global variable
     do                    -- new block
       local x = x         -- new 'x', with value 10
       print(x)            --> 10
       x = x+1
       do                  -- another block
         local x = x+1     -- another 'x'
         print(x)          --> 12
       end
       print(x)            --> 11
     end
     print(x)              --> 10  (the global one)
</pre>
<p>

<p>

 Notice that, in a declaration like <code>local x = x</code>, the new <code>x</code> being declared is not in scope yet, and so the second <code>x</code> refers to the outside variable.   
<p>

 Because of the lexical scoping rules, local variables can be freely accessed by functions defined inside their scope. A local variable used by an inner function is called an <i>upvalue</i>, or <i>external local variable</i>, inside the inner function.   
<p>

 Notice that each execution of a <b>local</b> statement defines new local variables. Consider the following example:
<pre>
     a = {}
     local x = 20
     for i=1,10 do
       local y = 0
       a[i] = function () y=y+1; return x+y end
     end
</pre>
<p>

<p>

 The loop creates ten closures (that is, ten instances of the anonymous function). Each of these closures uses a different <code>y</code> variable, while all of them share the same <code>x</code>.      
</div>



<div id="footer-left">&nbsp;<a href="LuaManual-2-5.html">
  Expressions</a></div>
<div id="footer-right"><a href="LuaManual-2-7.html">
  Error Handling</a>&nbsp;</div>

<div id="last-modified">

</div>

</div>
</body>
</html>
